<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2: Detection & Tracking Results Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        h1 { color: #1a365d; margin-bottom: 10px; }
        h2 { color: #2c5282; margin: 20px 0 15px; }
        h3 { color: #2b6cb0; margin: 15px 0 10px; }

        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .header h1 { color: white; font-size: 28px; }
        .header p { opacity: 0.9; }

        /* Winner Banner */
        .winner-banner {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .winner-banner h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 15px;
        }
        .winner-banner .config {
            font-size: 32px;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .winner-banner .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .winner-banner .stat {
            text-align: center;
        }
        .winner-banner .stat-value {
            font-size: 36px;
            font-weight: bold;
        }
        .winner-banner .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Progression Chart */
        .progression-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .progression-chart {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 30px;
            height: 300px;
            margin: 30px 0;
            padding: 20px;
        }
        .bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 200px;
        }
        .bar {
            width: 100%;
            border-radius: 8px 8px 0 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding: 10px;
            color: white;
            font-weight: bold;
            transition: all 0.3s;
        }
        .bar:hover { transform: scale(1.05); }
        .bar-value { font-size: 24px; margin-bottom: 5px; }
        .bar-improvement { font-size: 12px; opacity: 0.9; }
        .bar-label {
            margin-top: 10px;
            text-align: center;
            font-size: 12px;
            color: #475569;
            font-weight: 500;
        }
        .bar-model { font-weight: bold; color: #1e293b; }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
        }
        .stat-card .label {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }
        .stat-card.success .number { color: #16a34a; }
        .stat-card.warning .number { color: #ea580c; }
        .stat-card.primary .number { color: #7c3aed; }
        .stat-card.winner {
            background: linear-gradient(135deg, #bbf7d0 0%, #86efac 100%);
            border: 2px solid #16a34a;
        }
        .stat-card.winner .number { color: #14532d; }

        /* Model Comparison Cards */
        .model-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .model-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid #94a3b8;
        }
        .model-card.baseline { border-left-color: #64748b; }
        .model-card.improvement { border-left-color: #3b82f6; }
        .model-card.better { border-left-color: #8b5cf6; }
        .model-card.best {
            border-left-color: #10b981;
            background: linear-gradient(to right, #ecfdf5 0%, white 50%);
        }
        .model-card h4 {
            font-size: 16px;
            color: #1e293b;
            margin-bottom: 5px;
        }
        .model-card .model-name {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 15px;
        }
        .model-card .metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .model-card .metric {
            text-align: center;
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
        }
        .model-card .metric-value {
            font-size: 20px;
            font-weight: bold;
            color: #1e293b;
        }
        .model-card .metric-label {
            font-size: 11px;
            color: #64748b;
        }
        .model-card.best .metric-value { color: #059669; }
        .model-card .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
        }
        .badge.baseline { background: #e2e8f0; color: #475569; }
        .badge.good { background: #dbeafe; color: #1e40af; }
        .badge.better { background: #ede9fe; color: #5b21b6; }
        .badge.best { background: #d1fae5; color: #065f46; }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #f1f5f9;
            font-weight: 600;
            color: #475569;
            font-size: 12px;
            text-transform: uppercase;
        }
        tr:hover { background: #f8fafc; }
        td.positive { color: #16a34a; font-weight: 600; }
        td.negative { color: #dc2626; font-weight: 600; }
        td.highlight { background: #fef3c7; font-weight: 600; }
        td.best { background: #bbf7d0; font-weight: 600; }

        /* Section */
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section h3 {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .tab:hover { background: #cbd5e1; }
        .tab.active {
            background: #2563eb;
            color: white;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Legend */
        .legend {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        .legend-box.best { background: #bbf7d0; }
        .legend-box.highlight { background: #fef3c7; }

        /* Info box */
        .info-box {
            background: #eff6ff;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
        }
        .info-box strong { color: #1e40af; }

        .phase3-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        .phase3-box h3 {
            color: #92400e;
            margin-bottom: 15px;
            border: none;
            padding: 0;
        }
        .phase3-box ul {
            margin: 10px 0 0 20px;
            color: #78350f;
        }
        .phase3-box li { margin: 8px 0; }

        .timestamp {
            color: #64748b;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Phase 2: Detection & Tracking Results Dashboard</h1>
        <p>Complete model comparison: Dataset experiments + Architecture experiments</p>
        <p class="timestamp">Generated: December 2, 2025 | 16 Clips | 4 Model Configurations | 96 Total Tracking Videos</p>
    </div>

    <div class="winner-banner">
        <h2>PHASE 2 WINNER - RECOMMENDED FOR PHASE 3</h2>
        <div class="config">Merged Brackish+BRUV Dataset + RT-DETR Architecture</div>
        <div class="stats">
            <div class="stat">
                <div class="stat-value">27.3</div>
                <div class="stat-label">Avg Track Duration</div>
            </div>
            <div class="stat">
                <div class="stat-value">+72%</div>
                <div class="stat-label">vs UK BRUV Baseline</div>
            </div>
            <div class="stat">
                <div class="stat-value">1,681</div>
                <div class="stat-label">Max Track Duration</div>
            </div>
            <div class="stat">
                <div class="stat-value">56,605</div>
                <div class="stat-label">Total Detections</div>
            </div>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="number">16</div>
            <div class="label">Video Clips Tested</div>
        </div>
        <div class="stat-card primary">
            <div class="number">4</div>
            <div class="label">Model Configurations</div>
        </div>
        <div class="stat-card success">
            <div class="number">96</div>
            <div class="label">Total Tracking Videos</div>
        </div>
        <div class="stat-card warning">
            <div class="number">15,274</div>
            <div class="label">Training Images (Best Model)</div>
        </div>
    </div>

    <div class="progression-section">
        <h3>Performance Progression: Average Track Duration (Higher = Better)</h3>
        <p style="color: #64748b; margin-bottom: 10px;">Track duration measures how long the tracker can follow the same fish - longer tracks = more reliable tracking</p>

        <div class="progression-chart">
            <div class="bar-container">
                <div class="bar" style="height: 120px; background: linear-gradient(180deg, #64748b 0%, #475569 100%);">
                    <div class="bar-value">15.9</div>
                    <div class="bar-improvement">Baseline</div>
                </div>
                <div class="bar-label">
                    <div class="bar-model">UK BRUV Only</div>
                    YOLOv8s | 3k images
                </div>
            </div>
            <div class="bar-container">
                <div class="bar" style="height: 172px; background: linear-gradient(180deg, #3b82f6 0%, #1d4ed8 100%);">
                    <div class="bar-value">22.9</div>
                    <div class="bar-improvement">+44%</div>
                </div>
                <div class="bar-label">
                    <div class="bar-model">Brackish Only</div>
                    YOLOv8s | 11k images
                </div>
            </div>
            <div class="bar-container">
                <div class="bar" style="height: 186px; background: linear-gradient(180deg, #8b5cf6 0%, #6d28d9 100%);">
                    <div class="bar-value">24.8</div>
                    <div class="bar-improvement">+56%</div>
                </div>
                <div class="bar-label">
                    <div class="bar-model">Merged Brak+BRUV</div>
                    YOLOv8s | 15k images
                </div>
            </div>
            <div class="bar-container">
                <div class="bar" style="height: 205px; background: linear-gradient(180deg, #10b981 0%, #059669 100%);">
                    <div class="bar-value">27.3</div>
                    <div class="bar-improvement">+72%</div>
                </div>
                <div class="bar-label">
                    <div class="bar-model">Merged Brak+BRUV</div>
                    RT-DETR | 15k images
                </div>
            </div>
        </div>
    </div>

    <div class="model-cards">
        <div class="model-card baseline">
            <h4>1. UK BRUV Only <span class="badge baseline">Baseline</span></h4>
            <div class="model-name">uk_bruv_only_v1_yolov8s_best.pt | 3k training images</div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value">15.9</div>
                    <div class="metric-label">Avg Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">141</div>
                    <div class="metric-label">Max Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">11,668</div>
                    <div class="metric-label">Total Detections</div>
                </div>
                <div class="metric">
                    <div class="metric-value">754</div>
                    <div class="metric-label">Total Tracks</div>
                </div>
            </div>
        </div>

        <div class="model-card improvement">
            <h4>2. Brackish Only <span class="badge good">+44%</span></h4>
            <div class="model-name">Y12_11kL_12k(brackish)_E100_Augmented_best.pt | 11k images</div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value">22.9</div>
                    <div class="metric-label">Avg Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">253</div>
                    <div class="metric-label">Max Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">7,983</div>
                    <div class="metric-label">Total Detections</div>
                </div>
                <div class="metric">
                    <div class="metric-value">453</div>
                    <div class="metric-label">Total Tracks</div>
                </div>
            </div>
        </div>

        <div class="model-card better">
            <h4>3. Merged Brak+BRUV (YOLOv8s) <span class="badge better">+56%</span></h4>
            <div class="model-name">merged_brak_bruv_yolov8s_best.pt | 15,274 images</div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value">24.8</div>
                    <div class="metric-label">Avg Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">959</div>
                    <div class="metric-label">Max Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">13,730</div>
                    <div class="metric-label">Total Detections</div>
                </div>
                <div class="metric">
                    <div class="metric-value">681</div>
                    <div class="metric-label">Total Tracks</div>
                </div>
            </div>
        </div>

        <div class="model-card best">
            <h4>4. Merged Brak+BRUV (RT-DETR) <span class="badge best">BEST +72%</span></h4>
            <div class="model-name">merged_brak_bruv_rtdetr-l_best.pt | 15,274 images</div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value">27.3</div>
                    <div class="metric-label">Avg Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">1,681</div>
                    <div class="metric-label">Max Track Duration</div>
                </div>
                <div class="metric">
                    <div class="metric-value">56,605</div>
                    <div class="metric-label">Total Detections</div>
                </div>
                <div class="metric">
                    <div class="metric-value">2,616</div>
                    <div class="metric-label">Total Tracks</div>
                </div>
            </div>
        </div>
    </div>

    <div class="phase3-box">
        <h3>Phase 3 Recommendation</h3>
        <p><strong>Use the Merged Brackish+BRUV RT-DETR model for production:</strong></p>
        <ul>
            <li><strong>Dataset:</strong> merged_brak_bruv (15,274 images = 11k Brackish + 2k UK BRUV)</li>
            <li><strong>Architecture:</strong> RT-DETR-L (transformer-based, better accuracy)</li>
            <li><strong>Model file:</strong> merged_brak_bruv_rtdetr-l_best.pt (125.9 MB)</li>
            <li><strong>Note:</strong> RT-DETR is ~2.3x slower than YOLOv8s (13 FPS vs 30 FPS), but quality improvement is significant</li>
            <li><strong>Alternative:</strong> If speed is critical, use merged_brak_bruv_yolov8s_best.pt for real-time applications</li>
        </ul>
    </div>

    <!-- Phase 2.5 Results Section -->
    <div class="winner-banner" style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); margin-top: 30px;">
        <h2>PHASE 2.5 COMPLETE - UNIFIED DETECTION PIPELINE</h2>
        <div class="config">RT-DETR + V5 Motion Detection Fusion</div>
        <div class="stats">
            <div class="stat">
                <div class="stat-value">+77%</div>
                <div class="stat-label">More Tracks (clip021)</div>
            </div>
            <div class="stat">
                <div class="stat-value">12</div>
                <div class="stat-label">V5 Motion Tracks (clip011)</div>
            </div>
            <div class="stat">
                <div class="stat-value">18</div>
                <div class="stat-label">V5 Motion Tracks (clip021)</div>
            </div>
            <div class="stat">
                <div class="stat-value">23</div>
                <div class="stat-label">Unified V2 Tracks (clip021)</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h3>Phase 2.5: Unified Detection Pipeline Results</h3>
        <p style="color: #64748b; margin-bottom: 15px;">Combining RT-DETR appearance detection with V5 motion detection for comprehensive organism coverage</p>

        <table>
            <thead>
                <tr>
                    <th>Clip</th>
                    <th style="background: #fed7aa;">RT-DETR Only</th>
                    <th style="background: #ddd6fe;">V5 Motion Only</th>
                    <th style="background: #bbf7d0;">Unified V2</th>
                    <th>Improvement</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>clip011</strong></td>
                    <td>22 tracks</td>
                    <td>12 tracks</td>
                    <td class="best">17 tracks</td>
                    <td>Complementary detection</td>
                </tr>
                <tr>
                    <td><strong>clip021</strong></td>
                    <td>13 tracks</td>
                    <td class="highlight">18 tracks</td>
                    <td class="best">23 tracks</td>
                    <td class="positive">+77% over RT-DETR</td>
                </tr>
            </tbody>
        </table>

        <div class="info-box" style="background: #f3e8ff; border-color: #c084fc; margin-top: 20px;">
            <strong style="color: #7c3aed;">Phase 2.5 Key Findings:</strong>
            <ul style="margin: 10px 0 0 20px;">
                <li><strong>V5 Motion Detection Works:</strong> Detects slow-moving organisms (crabs, gobies) that RT-DETR misses</li>
                <li><strong>Unified Fusion Improves Coverage:</strong> Combining both detection modalities provides comprehensive organism detection</li>
                <li><strong>Detection Source Color Coding:</strong> Green=FUSED, Orange=RT-DETR only, Magenta=Motion only</li>
                <li><strong>Critical Parameters:</strong> dark_threshold=10, bright_threshold=25, min_area=30</li>
            </ul>
        </div>

        <p style="margin-top: 15px; color: #64748b; font-size: 14px;">
            <strong>Full Report:</strong> See PHASE_2.5_PROJECT_REPORT.md for detailed technical documentation.
            <br><strong>Output Files:</strong> phase2.5_testing/unified_comparison_v2/
        </p>
    </div>

    <div class="info-box">
        <strong>Key Insights from Phase 2:</strong>
        <ul style="margin: 10px 0 0 20px;">
            <li><strong>Dataset Diversity Matters:</strong> Merging Brackish + UK BRUV data improved track duration by 8% over Brackish alone</li>
            <li><strong>Architecture Matters:</strong> RT-DETR outperforms YOLOv8s by 10% on track duration, with 4x more detections</li>
            <li><strong>Track Duration is Key:</strong> This metric best indicates tracking quality - longer tracks = more reliable organism identification</li>
            <li><strong>Original Video is Best:</strong> No preprocessing needed - models trained on original footage work best on original footage</li>
        </ul>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('merged-comparison')">Merged Model Comparison</button>
        <button class="tab" onclick="showTab('original-comparison')">Original Model Comparison</button>
        <button class="tab" onclick="showTab('all-clips')">All Clips Detail</button>
    </div>

    <div id="merged-comparison" class="tab-content active">
        <div class="section">
            <h3>Merged Brackish+BRUV: YOLOv8s vs RT-DETR (Per Clip)</h3>
            <p style="color: #64748b; margin-bottom: 15px;">Comparing the best dataset with different architectures</p>

            <table>
                <thead>
                    <tr>
                        <th>Clip</th>
                        <th colspan="4" style="text-align: center; background: #ede9fe;">YOLOv8s</th>
                        <th colspan="4" style="text-align: center; background: #d1fae5;">RT-DETR</th>
                        <th>Winner</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th style="background: #ede9fe;">Detects</th>
                        <th style="background: #ede9fe;">Tracks</th>
                        <th style="background: #ede9fe;">Avg Dur</th>
                        <th style="background: #ede9fe;">Max Dur</th>
                        <th style="background: #d1fae5;">Detects</th>
                        <th style="background: #d1fae5;">Tracks</th>
                        <th style="background: #d1fae5;">Avg Dur</th>
                        <th style="background: #d1fae5;">Max Dur</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="merged-table">
                    <!-- Populated by JavaScript -->
                </tbody>
                <tfoot id="merged-totals">
                    <!-- Populated by JavaScript -->
                </tfoot>
            </table>
        </div>
    </div>

    <div id="original-comparison" class="tab-content">
        <div class="section">
            <h3>Original Comparison: UK BRUV vs Brackish (Per Clip)</h3>
            <p style="color: #64748b; margin-bottom: 15px;">Initial experiment comparing single-dataset models</p>

            <table>
                <thead>
                    <tr>
                        <th>Clip</th>
                        <th colspan="4" style="text-align: center; background: #dbeafe;">UK BRUV Model</th>
                        <th colspan="4" style="text-align: center; background: #ede9fe;">Brackish Model</th>
                        <th>Winner</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th style="background: #dbeafe;">Detects</th>
                        <th style="background: #dbeafe;">Tracks</th>
                        <th style="background: #dbeafe;">Avg Dur</th>
                        <th style="background: #dbeafe;">Max Dur</th>
                        <th style="background: #ede9fe;">Detects</th>
                        <th style="background: #ede9fe;">Tracks</th>
                        <th style="background: #ede9fe;">Avg Dur</th>
                        <th style="background: #ede9fe;">Max Dur</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="original-table">
                    <!-- Populated by JavaScript -->
                </tbody>
                <tfoot id="original-totals">
                    <!-- Populated by JavaScript -->
                </tfoot>
            </table>
        </div>
    </div>

    <div id="all-clips" class="tab-content">
        <div class="section">
            <h3>All Models - Detailed Comparison</h3>
            <p style="color: #64748b; margin-bottom: 15px;">Complete view of all 4 model configurations across all clips</p>

            <div class="legend">
                <div class="legend-item"><div class="legend-box best"></div> Best Avg Duration</div>
                <div class="legend-item"><div class="legend-box highlight"></div> Good (>=20 frames)</div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Clip</th>
                        <th colspan="2" style="text-align: center; background: #e2e8f0;">UK BRUV</th>
                        <th colspan="2" style="text-align: center; background: #dbeafe;">Brackish</th>
                        <th colspan="2" style="text-align: center; background: #ede9fe;">Merged YOLOv8s</th>
                        <th colspan="2" style="text-align: center; background: #d1fae5;">Merged RT-DETR</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th style="background: #e2e8f0;">Detects</th>
                        <th style="background: #e2e8f0;">Avg Dur</th>
                        <th style="background: #dbeafe;">Detects</th>
                        <th style="background: #dbeafe;">Avg Dur</th>
                        <th style="background: #ede9fe;">Detects</th>
                        <th style="background: #ede9fe;">Avg Dur</th>
                        <th style="background: #d1fae5;">Detects</th>
                        <th style="background: #d1fae5;">Avg Dur</th>
                    </tr>
                </thead>
                <tbody id="all-clips-table">
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // Merged model data (from tracking_comparison_results.json)
        const mergedData = {
            "yolov8s": {
                "clip011": { "detections": 446, "tracks": 3, "avg_track_duration": 157.0, "max_track_duration": 220 },
                "clip012": { "detections": 753, "tracks": 12, "avg_track_duration": 70.4, "max_track_duration": 243 },
                "clip021": { "detections": 503, "tracks": 12, "avg_track_duration": 49.1, "max_track_duration": 207 },
                "clip022": { "detections": 961, "tracks": 1, "avg_track_duration": 959.0, "max_track_duration": 959 },
                "clip031": { "detections": 572, "tracks": 22, "avg_track_duration": 31.2, "max_track_duration": 186 },
                "clip032": { "detections": 271, "tracks": 30, "avg_track_duration": 13.7, "max_track_duration": 33 },
                "clip041": { "detections": 151, "tracks": 9, "avg_track_duration": 25.1, "max_track_duration": 65 },
                "clip042": { "detections": 420, "tracks": 14, "avg_track_duration": 38.8, "max_track_duration": 204 },
                "clip051": { "detections": 5367, "tracks": 353, "avg_track_duration": 19.5, "max_track_duration": 122 },
                "clip052": { "detections": 938, "tracks": 82, "avg_track_duration": 15.5, "max_track_duration": 63 },
                "clip061": { "detections": 2, "tracks": 0, "avg_track_duration": 0, "max_track_duration": 0 },
                "clip062": { "detections": 58, "tracks": 2, "avg_track_duration": 32.5, "max_track_duration": 44 },
                "clip071": { "detections": 711, "tracks": 33, "avg_track_duration": 25.8, "max_track_duration": 110 },
                "clip072": { "detections": 2127, "tracks": 91, "avg_track_duration": 27.7, "max_track_duration": 129 },
                "clip081": { "detections": 437, "tracks": 14, "avg_track_duration": 37.9, "max_track_duration": 167 },
                "clip082": { "detections": 13, "tracks": 3, "avg_track_duration": 7.0, "max_track_duration": 9 }
            },
            "rtdetr": {
                "clip011": { "detections": 1717, "tracks": 69, "avg_track_duration": 32.5, "max_track_duration": 237 },
                "clip012": { "detections": 2232, "tracks": 115, "avg_track_duration": 26.2, "max_track_duration": 289 },
                "clip021": { "detections": 862, "tracks": 47, "avg_track_duration": 23.1, "max_track_duration": 195 },
                "clip022": { "detections": 1007, "tracks": 91, "avg_track_duration": 17.2, "max_track_duration": 140 },
                "clip031": { "detections": 998, "tracks": 55, "avg_track_duration": 22.3, "max_track_duration": 190 },
                "clip032": { "detections": 420, "tracks": 42, "avg_track_duration": 14.8, "max_track_duration": 82 },
                "clip041": { "detections": 410, "tracks": 22, "avg_track_duration": 23.2, "max_track_duration": 133 },
                "clip042": { "detections": 720, "tracks": 40, "avg_track_duration": 23.2, "max_track_duration": 127 },
                "clip051": { "detections": 7461, "tracks": 522, "avg_track_duration": 18.3, "max_track_duration": 144 },
                "clip052": { "detections": 961, "tracks": 95, "avg_track_duration": 14.7, "max_track_duration": 69 },
                "clip061": { "detections": 9721, "tracks": 367, "avg_track_duration": 33.4, "max_track_duration": 1039 },
                "clip062": { "detections": 25383, "tracks": 849, "avg_track_duration": 36.8, "max_track_duration": 1681 },
                "clip071": { "detections": 1382, "tracks": 87, "avg_track_duration": 19.3, "max_track_duration": 92 },
                "clip072": { "detections": 3039, "tracks": 200, "avg_track_duration": 19.2, "max_track_duration": 107 },
                "clip081": { "detections": 261, "tracks": 10, "avg_track_duration": 33.7, "max_track_duration": 111 },
                "clip082": { "detections": 31, "tracks": 5, "avg_track_duration": 8.2, "max_track_duration": 11 }
            }
        };

        // Load and display data
        Promise.all([
            fetch('tracking_traces/multi_model_tracking_results.json').then(r => r.json()).catch(() => ({})),
        ]).then(([originalData]) => {
            populateMergedTable();
            populateOriginalTable(originalData);
            populateAllClipsTable(originalData);
        });

        function populateMergedTable() {
            const clips = Object.keys(mergedData.yolov8s).sort();
            const rows = [];
            let y8Totals = { detections: 0, tracks: 0, durations: [], maxDur: 0 };
            let rtTotals = { detections: 0, tracks: 0, durations: [], maxDur: 0 };
            let y8Wins = 0, rtWins = 0;

            for (const clip of clips) {
                const y8 = mergedData.yolov8s[clip];
                const rt = mergedData.rtdetr[clip];

                const y8Avg = y8.avg_track_duration || 0;
                const rtAvg = rt.avg_track_duration || 0;

                let winner = '-';
                if (y8Avg > rtAvg && y8Avg > 0) {
                    winner = '<span style="color: #7c3aed; font-weight: bold;">YOLOv8s</span>';
                    y8Wins++;
                } else if (rtAvg > y8Avg && rtAvg > 0) {
                    winner = '<span style="color: #059669; font-weight: bold;">RT-DETR</span>';
                    rtWins++;
                }

                rows.push(`<tr>
                    <td><strong>${clip}</strong></td>
                    <td>${y8.detections.toLocaleString()}</td>
                    <td>${y8.tracks}</td>
                    <td class="${y8Avg > rtAvg ? 'best' : ''}">${y8Avg.toFixed(1)}</td>
                    <td>${y8.max_track_duration}</td>
                    <td>${rt.detections.toLocaleString()}</td>
                    <td>${rt.tracks}</td>
                    <td class="${rtAvg > y8Avg ? 'best' : ''}">${rtAvg.toFixed(1)}</td>
                    <td>${rt.max_track_duration.toLocaleString()}</td>
                    <td>${winner}</td>
                </tr>`);

                y8Totals.detections += y8.detections;
                y8Totals.tracks += y8.tracks;
                if (y8Avg > 0) y8Totals.durations.push(y8Avg);
                y8Totals.maxDur = Math.max(y8Totals.maxDur, y8.max_track_duration);

                rtTotals.detections += rt.detections;
                rtTotals.tracks += rt.tracks;
                if (rtAvg > 0) rtTotals.durations.push(rtAvg);
                rtTotals.maxDur = Math.max(rtTotals.maxDur, rt.max_track_duration);
            }

            document.getElementById('merged-table').innerHTML = rows.join('');

            const y8AvgOverall = y8Totals.durations.length > 0
                ? (y8Totals.durations.reduce((a,b) => a+b, 0) / y8Totals.durations.length).toFixed(1)
                : '0';
            const rtAvgOverall = rtTotals.durations.length > 0
                ? (rtTotals.durations.reduce((a,b) => a+b, 0) / rtTotals.durations.length).toFixed(1)
                : '0';

            document.getElementById('merged-totals').innerHTML = `
                <tr style="background: #f1f5f9; font-weight: bold;">
                    <td>TOTALS</td>
                    <td>${y8Totals.detections.toLocaleString()}</td>
                    <td>${y8Totals.tracks}</td>
                    <td>${y8AvgOverall}</td>
                    <td>${y8Totals.maxDur}</td>
                    <td>${rtTotals.detections.toLocaleString()}</td>
                    <td>${rtTotals.tracks.toLocaleString()}</td>
                    <td class="best">${rtAvgOverall}</td>
                    <td class="best">${rtTotals.maxDur.toLocaleString()}</td>
                    <td><span style="color: #059669; font-weight: bold;">RT-DETR</span></td>
                </tr>
                <tr style="background: #fef3c7;">
                    <td colspan="10" style="text-align: center;">
                        <strong>Win Count:</strong>
                        YOLOv8s: ${y8Wins} clips |
                        RT-DETR: ${rtWins} clips
                    </td>
                </tr>
            `;
        }

        function populateOriginalTable(data) {
            const clips = {};
            for (const [key, value] of Object.entries(data)) {
                const clip = value.clip;
                const model = value.model;
                const isUkBruv = model.includes('uk_bruv');

                if (!clips[clip]) clips[clip] = { uk_bruv: null, brackish: null };
                if (value.original) {
                    if (isUkBruv) clips[clip].uk_bruv = value.original;
                    else clips[clip].brackish = value.original;
                }
            }

            const rows = [];
            let ukTotals = { detections: 0, tracks: 0, durations: [], maxDur: 0 };
            let brTotals = { detections: 0, tracks: 0, durations: [], maxDur: 0 };
            let ukWins = 0, brWins = 0;

            for (const clip of Object.keys(clips).sort()) {
                const uk = clips[clip].uk_bruv;
                const br = clips[clip].brackish;

                if (uk && br) {
                    const ukAvg = uk.avg_track_duration || 0;
                    const brAvg = br.avg_track_duration || 0;

                    let winner = '-';
                    if (ukAvg > brAvg && ukAvg > 0) {
                        winner = '<span style="color: #2563eb;">UK BRUV</span>';
                        ukWins++;
                    } else if (brAvg > ukAvg && brAvg > 0) {
                        winner = '<span style="color: #7c3aed;">Brackish</span>';
                        brWins++;
                    }

                    rows.push(`<tr>
                        <td><strong>${clip}</strong></td>
                        <td>${uk.detections}</td>
                        <td>${uk.tracks}</td>
                        <td class="${ukAvg > brAvg ? 'best' : ''}">${ukAvg.toFixed(1)}</td>
                        <td>${uk.max_track_duration}</td>
                        <td>${br.detections}</td>
                        <td>${br.tracks}</td>
                        <td class="${brAvg > ukAvg ? 'best' : ''}">${brAvg.toFixed(1)}</td>
                        <td>${br.max_track_duration}</td>
                        <td>${winner}</td>
                    </tr>`);

                    ukTotals.detections += uk.detections;
                    ukTotals.tracks += uk.tracks;
                    if (ukAvg > 0) ukTotals.durations.push(ukAvg);
                    ukTotals.maxDur = Math.max(ukTotals.maxDur, uk.max_track_duration);

                    brTotals.detections += br.detections;
                    brTotals.tracks += br.tracks;
                    if (brAvg > 0) brTotals.durations.push(brAvg);
                    brTotals.maxDur = Math.max(brTotals.maxDur, br.max_track_duration);
                }
            }

            document.getElementById('original-table').innerHTML = rows.join('');

            const ukAvgOverall = ukTotals.durations.length > 0
                ? (ukTotals.durations.reduce((a,b) => a+b, 0) / ukTotals.durations.length).toFixed(1)
                : '0';
            const brAvgOverall = brTotals.durations.length > 0
                ? (brTotals.durations.reduce((a,b) => a+b, 0) / brTotals.durations.length).toFixed(1)
                : '0';

            document.getElementById('original-totals').innerHTML = `
                <tr style="background: #f1f5f9; font-weight: bold;">
                    <td>TOTALS</td>
                    <td>${ukTotals.detections.toLocaleString()}</td>
                    <td>${ukTotals.tracks}</td>
                    <td>${ukAvgOverall}</td>
                    <td>${ukTotals.maxDur}</td>
                    <td>${brTotals.detections.toLocaleString()}</td>
                    <td>${brTotals.tracks}</td>
                    <td class="best">${brAvgOverall}</td>
                    <td class="best">${brTotals.maxDur}</td>
                    <td><span style="color: #7c3aed;">Brackish (+44%)</span></td>
                </tr>
            `;
        }

        function populateAllClipsTable(originalData) {
            // Organize original data
            const origClips = {};
            for (const [key, value] of Object.entries(originalData)) {
                const clip = value.clip;
                const model = value.model;
                const isUkBruv = model.includes('uk_bruv');

                if (!origClips[clip]) origClips[clip] = { uk_bruv: null, brackish: null };
                if (value.original) {
                    if (isUkBruv) origClips[clip].uk_bruv = value.original;
                    else origClips[clip].brackish = value.original;
                }
            }

            const clips = Object.keys(mergedData.yolov8s).sort();
            const rows = [];

            for (const clip of clips) {
                const uk = origClips[clip]?.uk_bruv || { detections: 0, avg_track_duration: 0 };
                const br = origClips[clip]?.brackish || { detections: 0, avg_track_duration: 0 };
                const y8 = mergedData.yolov8s[clip];
                const rt = mergedData.rtdetr[clip];

                const durations = [
                    uk.avg_track_duration || 0,
                    br.avg_track_duration || 0,
                    y8.avg_track_duration || 0,
                    rt.avg_track_duration || 0
                ];
                const maxDur = Math.max(...durations);

                const getClass = (val) => {
                    if (val === maxDur && val > 0) return 'best';
                    if (val >= 20) return 'highlight';
                    return '';
                };

                rows.push(`<tr>
                    <td><strong>${clip}</strong></td>
                    <td>${uk.detections}</td>
                    <td class="${getClass(uk.avg_track_duration)}">${(uk.avg_track_duration || 0).toFixed(1)}</td>
                    <td>${br.detections}</td>
                    <td class="${getClass(br.avg_track_duration)}">${(br.avg_track_duration || 0).toFixed(1)}</td>
                    <td>${y8.detections.toLocaleString()}</td>
                    <td class="${getClass(y8.avg_track_duration)}">${y8.avg_track_duration.toFixed(1)}</td>
                    <td>${rt.detections.toLocaleString()}</td>
                    <td class="${getClass(rt.avg_track_duration)}">${rt.avg_track_duration.toFixed(1)}</td>
                </tr>`);
            }

            document.getElementById('all-clips-table').innerHTML = rows.join('');
        }
    </script>
</body>
</html>
